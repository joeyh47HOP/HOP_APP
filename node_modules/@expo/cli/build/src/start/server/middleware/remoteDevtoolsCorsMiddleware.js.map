{"version":3,"sources":["../../../../../src/start/server/middleware/remoteDevtoolsCorsMiddleware.ts"],"sourcesContent":["import type { IncomingMessage, ServerResponse } from 'http';\nimport { parse as parseUrl } from 'url';\n\n// Middleware that accepts multiple Access-Control-Allow-Origin for processing *.map.\n// This is a hook middleware before metro processing *.map,\n// which originally allow only devtools://devtools\nexport function remoteDevtoolsCorsMiddleware(\n  req: IncomingMessage,\n  res: ServerResponse,\n  next: (err?: Error) => void\n) {\n  if (req.url) {\n    const url = parseUrl(req.url);\n    const origin = req.headers.origin;\n    const isValidOrigin =\n      origin &&\n      ['devtools://devtools', 'https://chrome-devtools-frontend.appspot.com'].includes(origin);\n    if (url.pathname?.endsWith('.map') && origin && isValidOrigin) {\n      res.setHeader('Access-Control-Allow-Origin', origin);\n\n      // Prevent metro overwrite Access-Control-Allow-Origin header\n      const setHeader = res.setHeader.bind(res);\n      res.setHeader = (key, ...args) => {\n        if (key !== 'Access-Control-Allow-Origin') {\n          setHeader(key, ...args);\n        }\n        return res;\n      };\n    }\n  }\n  next();\n}\n"],"names":["remoteDevtoolsCorsMiddleware","req","res","next","url","parseUrl","origin","headers","isValidOrigin","includes","pathname","endsWith","setHeader","bind","key","args"],"mappings":"AAAA;;;;QAMgBA,4BAA4B,GAA5BA,4BAA4B;AALV,IAAA,IAAK,WAAL,KAAK,CAAA;AAKhC,SAASA,4BAA4B,CAC1CC,GAAoB,EACpBC,GAAmB,EACnBC,IAA2B,EAC3B;IACA,IAAIF,GAAG,CAACG,GAAG,EAAE;YAMPA,GAAY;QALhB,MAAMA,GAAG,GAAGC,CAAAA,GAAAA,IAAQ,AAAS,CAAA,MAAT,CAACJ,GAAG,CAACG,GAAG,CAAC,AAAC;QAC9B,MAAME,MAAM,GAAGL,GAAG,CAACM,OAAO,CAACD,MAAM,AAAC;QAClC,MAAME,aAAa,GACjBF,MAAM,IACN;YAAC,qBAAqB;YAAE,8CAA8C;SAAC,CAACG,QAAQ,CAACH,MAAM,CAAC,AAAC;QAC3F,IAAIF,CAAAA,CAAAA,GAAY,GAAZA,GAAG,CAACM,QAAQ,SAAU,GAAtBN,KAAAA,CAAsB,GAAtBA,GAAY,CAAEO,QAAQ,CAAC,MAAM,CAAC,KAAIL,MAAM,IAAIE,aAAa,EAAE;YAC7DN,GAAG,CAACU,SAAS,CAAC,6BAA6B,EAAEN,MAAM,CAAC,CAAC;YAErD,6DAA6D;YAC7D,MAAMM,SAAS,GAAGV,GAAG,CAACU,SAAS,CAACC,IAAI,CAACX,GAAG,CAAC,AAAC;YAC1CA,GAAG,CAACU,SAAS,GAAG,CAACE,GAAG,EAAKC,GAAAA,IAAI,GAAK;gBAChC,IAAID,GAAG,KAAK,6BAA6B,EAAE;oBACzCF,SAAS,CAACE,GAAG,KAAKC,IAAI,CAAC,CAAC;iBACzB;gBACD,OAAOb,GAAG,CAAC;aACZ,CAAC;SACH;KACF;IACDC,IAAI,EAAE,CAAC;CACR"}
{"version":3,"sources":["../../../../../src/start/server/metro/withMetroMultiPlatform.ts"],"sourcesContent":["/**\n * Copyright Â© 2022 650 Industries.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport fs from 'fs';\nimport { ConfigT } from 'metro-config';\nimport { Resolution, ResolutionContext } from 'metro-resolver';\nimport path from 'path';\nimport resolveFrom from 'resolve-from';\n\nimport { createFastResolver } from './createExpoMetroResolver';\nimport {\n  EXTERNAL_REQUIRE_NATIVE_POLYFILL,\n  EXTERNAL_REQUIRE_POLYFILL,\n  getNodeExternalModuleId,\n  isNodeExternal,\n  setupNodeExternals,\n} from './externals';\nimport { isFailedToResolveNameError, isFailedToResolvePathError } from './metroErrors';\nimport { importMetroResolverFromProject } from './resolveFromProject';\nimport { getAppRouterRelativeEntryPath } from './router';\nimport { withMetroResolvers } from './withMetroResolvers';\nimport { Log } from '../../../log';\nimport { FileNotifier } from '../../../utils/FileNotifier';\nimport { env } from '../../../utils/env';\nimport { installExitHooks } from '../../../utils/exit';\nimport { isInteractive } from '../../../utils/interactive';\nimport { loadTsConfigPathsAsync, TsConfigPaths } from '../../../utils/tsconfig/loadTsConfigPaths';\nimport { resolveWithTsConfigPaths } from '../../../utils/tsconfig/resolveWithTsConfigPaths';\nimport { WebSupportProjectPrerequisite } from '../../doctor/web/WebSupportProjectPrerequisite';\nimport { PlatformBundlers } from '../platformBundlers';\n\ntype Mutable<T> = { -readonly [K in keyof T]: T[K] };\n\nconst debug = require('debug')('expo:start:server:metro:multi-platform') as typeof console.log;\n\nfunction withWebPolyfills(config: ConfigT, projectRoot: string): ConfigT {\n  const originalGetPolyfills = config.serializer.getPolyfills\n    ? config.serializer.getPolyfills.bind(config.serializer)\n    : () => [];\n\n  const getPolyfills = (ctx: { platform: string | null }): readonly string[] => {\n    if (ctx.platform === 'web') {\n      return [\n        // NOTE: We might need this for all platforms\n        path.join(projectRoot, EXTERNAL_REQUIRE_POLYFILL),\n        // TODO: runtime polyfills, i.e. Fast Refresh, error overlay, React Dev Tools...\n      ];\n    }\n    // Generally uses `rn-get-polyfills`\n    const polyfills = originalGetPolyfills(ctx);\n\n    return [...polyfills, EXTERNAL_REQUIRE_NATIVE_POLYFILL];\n  };\n\n  return {\n    ...config,\n    serializer: {\n      ...config.serializer,\n      getPolyfills,\n    },\n  };\n}\n\nfunction normalizeSlashes(p: string) {\n  return p.replace(/\\\\/g, '/');\n}\n\nexport function getNodejsExtensions(srcExts: readonly string[]): string[] {\n  const mjsExts = srcExts.filter((ext) => /mjs$/.test(ext));\n  const nodejsSourceExtensions = srcExts.filter((ext) => !/mjs$/.test(ext));\n  // find index of last `*.js` extension\n  const jsIndex = nodejsSourceExtensions.reduce((index, ext, i) => {\n    return /jsx?$/.test(ext) ? i : index;\n  }, -1);\n\n  // insert `*.mjs` extensions after `*.js` extensions\n  nodejsSourceExtensions.splice(jsIndex + 1, 0, ...mjsExts);\n\n  return nodejsSourceExtensions;\n}\n\n/**\n * Apply custom resolvers to do the following:\n * - Disable `.native.js` extensions on web.\n * - Alias `react-native` to `react-native-web` on web.\n * - Redirect `react-native-web/dist/modules/AssetRegistry/index.js` to `@react-native/assets/registry.js` on web.\n * - Add support for `tsconfig.json`/`jsconfig.json` aliases via `compilerOptions.paths`.\n */\nexport function withExtendedResolver(\n  config: ConfigT,\n  {\n    projectRoot,\n    tsconfig,\n    platforms,\n    isTsconfigPathsEnabled,\n    isFastResolverEnabled,\n  }: {\n    projectRoot: string;\n    tsconfig: TsConfigPaths | null;\n    platforms: string[];\n    isTsconfigPathsEnabled?: boolean;\n    isFastResolverEnabled?: boolean;\n  }\n) {\n  if (isFastResolverEnabled) {\n    Log.warn(`Experimental bundling features are enabled.`);\n  }\n\n  // Get the `transformer.assetRegistryPath`\n  // this needs to be unified since you can't dynamically\n  // swap out the transformer based on platform.\n  const assetRegistryPath = fs.realpathSync(\n    // This is the native asset registry alias for native.\n    path.resolve(resolveFrom(projectRoot, 'react-native/Libraries/Image/AssetRegistry'))\n    // NOTE(EvanBacon): This is the newer import but it doesn't work in the expo/expo monorepo.\n    // path.resolve(resolveFrom(projectRoot, '@react-native/assets-registry/registry.js'))\n  );\n\n  let reactNativeWebAppContainer: string | null = null;\n  try {\n    reactNativeWebAppContainer = fs.realpathSync(\n      // This is the native asset registry alias for native.\n      path.resolve(resolveFrom(projectRoot, 'expo-router/build/fork/react-native-web-container'))\n      // NOTE(EvanBacon): This is the newer import but it doesn't work in the expo/expo monorepo.\n      // path.resolve(resolveFrom(projectRoot, '@react-native/assets/registry.js'))\n    );\n  } catch {}\n\n  const isWebEnabled = platforms.includes('web');\n\n  const resolver = isFastResolverEnabled\n    ? createFastResolver({ preserveSymlinks: config.resolver?.unstable_enableSymlinks ?? false })\n    : importMetroResolverFromProject(projectRoot).resolve;\n\n  const extraNodeModules: { [key: string]: Record<string, string> } = {};\n\n  const aliases: { [key: string]: Record<string, string> } = {\n    web: {\n      'react-native': 'react-native-web',\n      'react-native/index': 'react-native-web',\n    },\n  };\n\n  if (isWebEnabled) {\n    // Allow `react-native-web` to be optional when web is not enabled but path aliases is.\n    extraNodeModules['web'] = {\n      'react-native': path.resolve(require.resolve('react-native-web/package.json'), '..'),\n    };\n  }\n\n  const preferredMainFields: { [key: string]: string[] } = {\n    // Defaults from Expo Webpack. Most packages using `react-native` don't support web\n    // in the `react-native` field, so we should prefer the `browser` field.\n    // https://github.com/expo/router/issues/37\n    web: ['browser', 'module', 'main'],\n  };\n\n  let tsConfigResolve = tsconfig?.paths\n    ? resolveWithTsConfigPaths.bind(resolveWithTsConfigPaths, {\n        paths: tsconfig.paths ?? {},\n        baseUrl: tsconfig.baseUrl,\n      })\n    : null;\n\n  if (isTsconfigPathsEnabled && isInteractive()) {\n    // TODO: We should track all the files that used imports and invalidate them\n    // currently the user will need to save all the files that use imports to\n    // use the new aliases.\n    const configWatcher = new FileNotifier(projectRoot, ['./tsconfig.json', './jsconfig.json']);\n    configWatcher.startObserving(() => {\n      debug('Reloading tsconfig.json');\n      loadTsConfigPathsAsync(projectRoot).then((tsConfigPaths) => {\n        if (tsConfigPaths?.paths && !!Object.keys(tsConfigPaths.paths).length) {\n          debug('Enabling tsconfig.json paths support');\n          tsConfigResolve = resolveWithTsConfigPaths.bind(resolveWithTsConfigPaths, {\n            paths: tsConfigPaths.paths ?? {},\n            baseUrl: tsConfigPaths.baseUrl,\n          });\n        } else {\n          debug('Disabling tsconfig.json paths support');\n          tsConfigResolve = null;\n        }\n      });\n    });\n\n    // TODO: This probably prevents the process from exiting.\n    installExitHooks(() => {\n      configWatcher.stopObserving();\n    });\n  } else {\n    debug('Skipping tsconfig.json paths support');\n  }\n\n  let nodejsSourceExtensions: string[] | null = null;\n\n  const shimsFolder = path.join(require.resolve('@expo/cli/package.json'), '..', 'static/shims');\n\n  return withMetroResolvers(config, projectRoot, [\n    // Add a resolver to alias the web asset resolver.\n    (immutableContext: ResolutionContext, moduleName: string, platform: string | null) => {\n      let context = {\n        ...immutableContext,\n      } as Mutable<ResolutionContext> & {\n        mainFields: string[];\n        customResolverOptions?: Record<string, string>;\n      };\n\n      const environment = context.customResolverOptions?.environment;\n      const isNode = environment === 'node';\n\n      // TODO: We need to prevent the require.context from including API routes as these use externals.\n      // Should be fine after async routes lands.\n      if (isNode) {\n        const moduleId = isNodeExternal(moduleName);\n        if (moduleId) {\n          moduleName = getNodeExternalModuleId(context.originModulePath, moduleId);\n          debug(`Redirecting Node.js external \"${moduleId}\" to \"${moduleName}\"`);\n        }\n\n        // Adjust nodejs source extensions to sort mjs after js, including platform variants.\n        if (nodejsSourceExtensions === null) {\n          nodejsSourceExtensions = getNodejsExtensions(context.sourceExts);\n        }\n        context.sourceExts = nodejsSourceExtensions;\n      }\n\n      // Conditionally remap `react-native` to `react-native-web` on web in\n      // a way that doesn't require Babel to resolve the alias.\n      if (platform && platform in aliases && aliases[platform][moduleName]) {\n        moduleName = aliases[platform][moduleName];\n      }\n\n      // TODO: We may be able to remove this in the future, it's doing no harm\n      // by staying here.\n      // Conditionally remap `react-native` to `react-native-web`\n      if (platform && platform in extraNodeModules) {\n        context.extraNodeModules = {\n          ...extraNodeModules[platform],\n          ...context.extraNodeModules,\n        };\n      }\n\n      if (tsconfig?.baseUrl && isTsconfigPathsEnabled) {\n        context = {\n          ...context,\n          nodeModulesPaths: [\n            ...immutableContext.nodeModulesPaths,\n            // add last to ensure node modules are resolved first\n            tsconfig.baseUrl,\n          ],\n        };\n      }\n\n      let mainFields: string[] = context.mainFields;\n\n      if (isNode) {\n        // Node.js runtimes should only be importing main at the moment.\n        // This is a temporary fix until we can support the package.json exports.\n        mainFields = ['main', 'module'];\n      } else if (env.EXPO_METRO_NO_MAIN_FIELD_OVERRIDE) {\n        mainFields = context.mainFields;\n      } else if (platform && platform in preferredMainFields) {\n        mainFields = preferredMainFields[platform];\n      }\n      function doResolve(moduleName: string): Resolution | null {\n        return resolver(\n          {\n            ...context,\n            resolveRequest: undefined,\n            mainFields,\n            // Passing `mainFields` directly won't be considered (in certain version of Metro)\n            // we need to extend the `getPackageMainPath` directly to\n            // use platform specific `mainFields`.\n            // @ts-ignore\n            getPackageMainPath(packageJsonPath) {\n              // @ts-expect-error: mainFields is not on type\n              const package_ = context.moduleCache.getPackage(packageJsonPath);\n              return package_.getMain(mainFields);\n            },\n          },\n          moduleName,\n          platform\n        );\n      }\n\n      function optionalResolve(moduleName: string): Resolution | null {\n        try {\n          return doResolve(moduleName);\n        } catch (error) {\n          // If the error is directly related to a resolver not being able to resolve a module, then\n          // we can ignore the error and try the next resolver. Otherwise, we should throw the error.\n          const isResolutionError =\n            isFailedToResolveNameError(error) || isFailedToResolvePathError(error);\n          if (!isResolutionError) {\n            throw error;\n          }\n        }\n        return null;\n      }\n\n      let result: Resolution | null = null;\n\n      // React Native uses `event-target-shim` incorrectly and this causes the native runtime\n      // to fail to load. This is a temporary workaround until we can fix this upstream.\n      // https://github.com/facebook/react-native/pull/38628\n      if (\n        moduleName.includes('event-target-shim') &&\n        context.originModulePath.includes(path.sep + 'react-native' + path.sep)\n      ) {\n        context.sourceExts = context.sourceExts.filter((f) => !f.includes('mjs'));\n        debug('Skip mjs support for event-target-shim in:', context.originModulePath);\n      }\n\n      if (tsConfigResolve) {\n        result = tsConfigResolve(\n          {\n            originModulePath: context.originModulePath,\n            moduleName,\n          },\n          optionalResolve\n        );\n      }\n\n      if (\n        !isFastResolverEnabled &&\n        // is web\n        platform === 'web' &&\n        // Not server runtime\n        !isNode &&\n        // Is Node.js built-in\n        isNodeExternal(moduleName)\n      ) {\n        // Perform optional resolve first. If the module doesn't exist (no module in the node_modules)\n        // then we can mock the file to use an empty module.\n        result ??= optionalResolve(moduleName);\n\n        if (!result) {\n          // In this case, mock the file to use an empty module.\n          return {\n            type: 'empty',\n          };\n        }\n      }\n\n      result ??= doResolve(moduleName);\n\n      if (result?.type === 'sourceFile') {\n        // Replace the web resolver with the original one.\n        // This is basically an alias for web-only.\n        if (shouldAliasAssetRegistryForWeb(platform, result)) {\n          // @ts-expect-error: `readonly` for some reason.\n          result.filePath = assetRegistryPath;\n        }\n\n        // React Native Web adds a couple extra divs for no reason, these\n        // make static rendering much harder as we expect the root element to be `<html>`.\n        // This resolution will alias to a simple in-out component to avoid React Native web.\n        if (\n          // Only apply the transform if expo-router is present.\n          reactNativeWebAppContainer &&\n          shouldAliasModule(\n            {\n              platform,\n              result,\n            },\n            {\n              platform: 'web',\n              output: 'react-native-web/dist/exports/AppRegistry/AppContainer.js',\n            }\n          )\n        ) {\n          // @ts-expect-error: `readonly` for some reason.\n          result.filePath = reactNativeWebAppContainer;\n        } else if (platform === 'web' && result.filePath.includes('node_modules')) {\n          // Replace with static shims\n\n          const normalName = normalizeSlashes(result.filePath)\n            // Drop everything up until the `node_modules` folder.\n            .replace(/.*node_modules\\//, '');\n\n          const shimPath = path.join(shimsFolder, normalName);\n          if (fs.existsSync(shimPath)) {\n            // @ts-expect-error: `readonly` for some reason.\n            result.filePath = shimPath;\n          }\n        }\n      }\n      return result;\n    },\n  ]);\n}\n\n/** @returns `true` if the incoming resolution should be swapped on web. */\nexport function shouldAliasAssetRegistryForWeb(\n  platform: string | null,\n  result: Resolution\n): boolean {\n  return (\n    platform === 'web' &&\n    result?.type === 'sourceFile' &&\n    typeof result?.filePath === 'string' &&\n    normalizeSlashes(result.filePath).endsWith(\n      'react-native-web/dist/modules/AssetRegistry/index.js'\n    )\n  );\n}\n/** @returns `true` if the incoming resolution should be swapped. */\nexport function shouldAliasModule(\n  input: {\n    platform: string | null;\n    result: Resolution;\n  },\n  alias: { platform: string; output: string }\n): boolean {\n  return (\n    input.platform === alias.platform &&\n    input.result?.type === 'sourceFile' &&\n    typeof input.result?.filePath === 'string' &&\n    normalizeSlashes(input.result.filePath).endsWith(alias.output)\n  );\n}\n\n/** Add support for `react-native-web` and the Web platform. */\nexport async function withMetroMultiPlatformAsync(\n  projectRoot: string,\n  {\n    config,\n    platformBundlers,\n    isTsconfigPathsEnabled,\n    webOutput,\n    routerDirectory,\n    isFastResolverEnabled,\n  }: {\n    config: ConfigT;\n    isTsconfigPathsEnabled: boolean;\n    platformBundlers: PlatformBundlers;\n    webOutput?: 'single' | 'static' | 'server';\n    routerDirectory: string;\n    isFastResolverEnabled?: boolean;\n  }\n) {\n  // Auto pick app entry for router.\n  process.env.EXPO_ROUTER_APP_ROOT = getAppRouterRelativeEntryPath(projectRoot, routerDirectory);\n\n  // Required for @expo/metro-runtime to format paths in the web LogBox.\n  process.env.EXPO_PUBLIC_PROJECT_ROOT = process.env.EXPO_PUBLIC_PROJECT_ROOT ?? projectRoot;\n\n  if (['static', 'server'].includes(webOutput ?? '')) {\n    // Enable static rendering in runtime space.\n    process.env.EXPO_PUBLIC_USE_STATIC = '1';\n  }\n\n  // Ensure the cache is invalidated if these values change.\n  // @ts-expect-error\n  config.transformer._expoRouterRootDirectory = process.env.EXPO_ROUTER_APP_ROOT;\n  // @ts-expect-error\n  config.transformer._expoRouterWebRendering = webOutput;\n  // TODO: import mode\n\n  if (platformBundlers.web === 'metro') {\n    await new WebSupportProjectPrerequisite(projectRoot).assertAsync();\n  }\n\n  let tsconfig: null | TsConfigPaths = null;\n\n  if (isTsconfigPathsEnabled) {\n    tsconfig = await loadTsConfigPathsAsync(projectRoot);\n  }\n\n  await setupNodeExternals(projectRoot);\n\n  return withMetroMultiPlatform(projectRoot, {\n    config,\n    platformBundlers,\n    tsconfig,\n    isTsconfigPathsEnabled,\n    isFastResolverEnabled,\n  });\n}\n\nfunction withMetroMultiPlatform(\n  projectRoot: string,\n  {\n    config,\n    platformBundlers,\n    isTsconfigPathsEnabled,\n    tsconfig,\n    isFastResolverEnabled,\n  }: {\n    config: ConfigT;\n    isTsconfigPathsEnabled: boolean;\n    platformBundlers: PlatformBundlers;\n    tsconfig: TsConfigPaths | null;\n    isFastResolverEnabled?: boolean;\n  }\n) {\n  let expoConfigPlatforms = Object.entries(platformBundlers)\n    .filter(([, bundler]) => bundler === 'metro')\n    .map(([platform]) => platform);\n\n  if (Array.isArray(config.resolver.platforms)) {\n    expoConfigPlatforms = [...new Set(expoConfigPlatforms.concat(config.resolver.platforms))];\n  }\n\n  // @ts-expect-error: typed as `readonly`.\n  config.resolver.platforms = expoConfigPlatforms;\n\n  if (expoConfigPlatforms.includes('web')) {\n    config = withWebPolyfills(config, projectRoot);\n  }\n\n  return withExtendedResolver(config, {\n    projectRoot,\n    tsconfig,\n    isTsconfigPathsEnabled,\n    platforms: expoConfigPlatforms,\n    isFastResolverEnabled,\n  });\n}\n"],"names":["getNodejsExtensions","withExtendedResolver","shouldAliasAssetRegistryForWeb","shouldAliasModule","withMetroMultiPlatformAsync","debug","require","withWebPolyfills","config","projectRoot","originalGetPolyfills","serializer","getPolyfills","bind","ctx","platform","path","join","EXTERNAL_REQUIRE_POLYFILL","polyfills","EXTERNAL_REQUIRE_NATIVE_POLYFILL","normalizeSlashes","p","replace","srcExts","mjsExts","filter","ext","test","nodejsSourceExtensions","jsIndex","reduce","index","i","splice","tsconfig","platforms","isTsconfigPathsEnabled","isFastResolverEnabled","Log","warn","assetRegistryPath","fs","realpathSync","resolve","resolveFrom","reactNativeWebAppContainer","isWebEnabled","includes","resolver","createFastResolver","preserveSymlinks","unstable_enableSymlinks","importMetroResolverFromProject","extraNodeModules","aliases","web","preferredMainFields","tsConfigResolve","paths","resolveWithTsConfigPaths","baseUrl","isInteractive","configWatcher","FileNotifier","startObserving","loadTsConfigPathsAsync","then","tsConfigPaths","Object","keys","length","installExitHooks","stopObserving","shimsFolder","withMetroResolvers","immutableContext","moduleName","context","environment","customResolverOptions","isNode","moduleId","isNodeExternal","getNodeExternalModuleId","originModulePath","sourceExts","nodeModulesPaths","mainFields","env","EXPO_METRO_NO_MAIN_FIELD_OVERRIDE","doResolve","resolveRequest","undefined","getPackageMainPath","packageJsonPath","package_","moduleCache","getPackage","getMain","optionalResolve","error","isResolutionError","isFailedToResolveNameError","isFailedToResolvePathError","result","sep","f","type","filePath","output","normalName","shimPath","existsSync","endsWith","input","alias","platformBundlers","webOutput","routerDirectory","process","EXPO_ROUTER_APP_ROOT","getAppRouterRelativeEntryPath","EXPO_PUBLIC_PROJECT_ROOT","EXPO_PUBLIC_USE_STATIC","transformer","_expoRouterRootDirectory","_expoRouterWebRendering","WebSupportProjectPrerequisite","assertAsync","setupNodeExternals","withMetroMultiPlatform","expoConfigPlatforms","entries","bundler","map","Array","isArray","Set","concat"],"mappings":"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"}